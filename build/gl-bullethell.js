var glb={};void 0===window.SCREEN_WIDTH&&(window.SCREEN_WIDTH=640),void 0===window.SCREEN_HEIGHT&&(window.SCREEN_HEIGHT=960),void 0===window.GL_QUALITY&&(window.GL_QUALITY=.5),void 0===window.GL_PIXEL_WIDTH&&(window.GL_PIXEL_WIDTH=~~(window.SCREEN_WIDTH*window.GL_QUALITY)),void 0===window.GL_PIXEL_HEIGHT&&(window.GL_PIXEL_HEIGHT=~~(window.SCREEN_HEIGHT*window.GL_QUALITY)),void 0===window.BULLET_APPEALANCE&&(window.BULLET_APPEALANCE=.1*window.GL_PIXEL_WIDTH),void 0===window.BULLET_SIZE&&(window.BULLET_SIZE=15);var GL=WebGLRenderingContext;Number.prototype.toFloatString=function(){return this%1?""+this:""+this+".0"},phina.namespace(function(){phina.define("glb.AutoAim",{superClass:"phina.accessory.Accessory",aimTarget:null,maxAngleVelocity:12*Math.DEG_TO_RAD,init:function(){this.superInit();var a=this;this.on("attached",function(){this.target.lockOn=function(b){a.aimTarget=b}})},update:function(a){if(null!=this.aimTarget){var b=this.target,c=this.aimTarget;b.needsUpdate&&b.updateMatrix(),c.needsUpdate&&c.updateMatrix();var d=glb.Vector3.Y.clone().transformQuat(b.rotation),e=c.position.clone();e=b.worldToLocal(e),e=e.sub(b.position).normalize(),d.z=0,e.z=0;var f=glb.Quat().rotationTo(d,e),g=f.getAngle();g<=this.maxAngleVelocity?(b.rotation.mul(f),b.needsUpdate=!0):(b.rotation.slerp(f,this.maxAngleVelocity/g),b.needsUpdate=!0)}}})}),function(){phina.define("glb.Camera",{superClass:"phina.app.Element",position:null,target:null,up:null,vMatrix:null,pMatrix:null,vpMatrix:null,needsUpdate:!1,init:function(){this.superInit(),this.position=glb.Vector3(0,0,10),this.target=glb.Vector3(),this.up=glb.Vector3(0,1,0),this.vMatrix=glb.Matrix4(),this.pMatrix=glb.Matrix4(),this.vpMatrix=glb.Matrix4(),this.updateMatrix()},updateMatrix:function(){this._updateProjectionMatrix(),this.up.normalize(),this.vMatrix.lookAt(this.position,this.target,this.up),this.vpMatrix.copy(this.pMatrix).mul(this.vMatrix),this.needsUpdate=!1},_updateProjectionMatrix:function(){},getScreenCoord:function(){var a=null;return function(b){return null===a&&(a=vec4.create()),vec4.set(a,b.x,b.y,b.z||0,1),vec4.transformMat4(a,a,this.vpMatrix.array),glb.Vector2(a[0]/a[3],a[1]/a[3])}}(),_accessor:{x:{set:function(a){this.position.x=a,this.needsUpdate=!0},get:function(){return this.position.x}},y:{set:function(a){this.position.y=a,this.needsUpdate=!0},get:function(){return this.position.y}},z:{set:function(a){this.position.z=a,this.needsUpdate=!0},get:function(){return this.position.z}},targetX:{set:function(a){this.target.x=a,this.needsUpdate=!0},get:function(){return this.target.x}},targetY:{set:function(a){this.target.y=a,this.needsUpdate=!0},get:function(){return this.target.y}},targetZ:{set:function(a){this.target.z=a,this.needsUpdate=!0},get:function(){return this.target.z}},upX:{set:function(a){this.up.x=a,this.needsUpdate=!0},get:function(){return this.up.x}},upY:{set:function(a){this.up.y=a,this.needsUpdate=!0},get:function(){return this.up.y}},upZ:{set:function(a){this.up.z=a,this.needsUpdate=!0},get:function(){return this.up.z}}},setPosition:function(a,b,c){this.position.set(a,b,c),this.needsUpdate=!0}})}(),phina.define("glb.OrthoCamera",{superClass:"glb.Camera",init:function(a,b,c,d,e,f){this.left=a,this.right=b,this.bottom=c,this.top=d,this.near=e,this.far=f,this.superInit()},_updateProjectionMatrix:function(){this.pMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)}}),phina.define("glb.PerspectiveCamera",{superClass:"glb.Camera",init:function(a,b,c,d){this.fovy=a,this.aspect=b,this.near=c,this.far=d,this.superInit()},_updateProjectionMatrix:function(){this.pMatrix.perspective(this.fovy,this.aspect,this.near,this.far)}}),phina.namespace(function(){phina.define("glb.Element",{superClass:"phina.app.Element",init:function(){this.superInit()},build:function(a){},render:function(a,b){}})}),function(){phina.define("glb.GLLayer",{superClass:"phina.display.CanvasElement",domElement:null,gl:null,ext:null,screen:null,init:function(a){this.superInit(),a?this.domElement=window.document.querySelector(a):this.domElement=window.document.createElement("canvas"),this.gl=this.domElement.getContext("webgl",{preserveDrawingBuffer:!0}),this.ext=this.gl.getExtension("OES_vertex_array_object"),null==this.ext&&console.warn("VAOはサポートされてない！");var b=this.gl;b.clearColor(0,0,0,0),b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL),b.enable(b.CULL_FACE),this.setSize(GL_PIXEL_WIDTH,GL_PIXEL_HEIGHT)},createTexture:function(a,b){b=b||0;var c=this.gl;c.activeTexture(c.TEXTURE0+b);var d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a),c.generateMipmap(c.TEXTURE_2D),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,null),d},attachScreen:function(a){var b=this.gl;return this.screen=a,a?(b.bindFramebuffer(b.FRAMEBUFFER,a.frameBuffer),b.viewport(0,0,a.width,a.height)):(b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,this.width,this.height)),this},build:function(a){this.buildObj(a)},buildObj:function(a){var b=this;a.isBuilt||(a.build&&a.build(this),a.isBuilt=!0),a.children.forEach(function(a){b.buildObj(a)})},render:function(a,b){var c=this,d=this.gl;a.needsUpdate&&a.updateMatrix(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),this.children.forEach(function(d){c.renderObj(d,a.vpMatrix,b,glb.Matrix4())}),d.flush()},renderObj:function(a,b,c){var d=this;a.isBuilt||(a.build&&a.build(this),a.isBuilt=!0),a.render&&a.visible&&a.render(this,b,c),a.children.forEach(function(a){d.renderObj(a,b,c)})},draw:function(a){a.context.drawImage(this.domElement,0,0,a.width,a.height)},setSize:function(a,b){return this.width=this.domElement.width=a,this.height=this.domElement.height=b,this.gl.viewport(0,0,a,b),this},fitScreen:function(a){a=void 0===a?!0:a;var b=function(){var a=this.domElement,b=a.style;b.position="absolute",b.margin="auto",b.left="0px",b.top="0px",b.bottom="0px",b.right="0px";var c=a.width/window.innerWidth,d=a.height/window.innerHeight,e=a.height/a.width;c>d?(b.width=Math.floor(innerWidth)+"px",b.height=Math.floor(innerWidth*e)+"px"):(b.width=Math.floor(innerHeight/e)+"px",b.height=Math.floor(innerHeight)+"px")}.bind(this);return b(),a&&window.addEventListener("resize",b,!1),this}})}(),phina.namespace(function(){phina.define("glb.Light",{superClass:"phina.app.Element",lightDirection:null,lightColor:null,ambientColor:null,init:function(){this.superInit(),this.lightDirection=glb.Vector3(0,-1,1).normalize(),this.lightColor=phina.util.Color(250,250,250,1),this.ambientColor=phina.util.Color(20,20,20,1)},_accessor:{directionX:{get:function(){return this.lightDirection.x},set:function(a){this.lightDirection.x=a}},directionY:{get:function(){return this.lightDirection.y},set:function(a){this.lightDirection.y=a}},directionZ:{get:function(){return this.lightDirection.z},set:function(a){this.lightDirection.z=a}},colorR:{get:function(){return this.lightColor.r},set:function(a){this.lightColor.r=a}},colorG:{get:function(){return this.lightColor.g},set:function(a){this.lightColor.g=a}},colorB:{get:function(){return this.lightColor.b},set:function(a){this.lightColor.b=a}},ambientColorR:{get:function(){return this.ambientColor.r},set:function(a){this.ambientColor.r=a}},ambientColorG:{get:function(){return this.ambientColor.g},set:function(a){this.ambientColor.g=a}},ambientColorB:{get:function(){return this.ambientColor.b},set:function(a){this.ambientColor.b=a}}}})}),phina.namespace(function(){phina.define("glb.Mesh",{superClass:"glb.Object3D",init:function(a,b){this.superInit(),this.geometry=a,this.material=b},setGeometry:function(a){return this.geometry=a,this},getMaterial:function(a){return this.material=a,this},build:function(a){var b=a.gl,c=a.ext;this.geometry.build(a),this.material.build(a),null!==c&&(this.material.setVao(a),this.material.setAttributes(a,this.geometry),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.geometry.index),this.material.unsetVao(a))},render:function(a,b,c){var d=a.gl,e=a.ext;this.needsUpdate&&this.updateMatrix(),this.getWorldMatrix(),this.material.setProgram(a),null!==e?this.material.setVao(a):(this.material.setAttributes(a,this.geometry),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.geometry.index)),this.material.setTextures(a),this.material.uniforms.invMatrix&&(mat4.invert(this.invMatrix.array,glb.Matrix4.mul(b,this.worldMatrix).array),this.material.setUniform(a,"invMatrix",this.invMatrix)),this.material.setUniforms(a,this),this.material.setUniform(a,"vpMatrix",b),c&&(this.material.setUniform(a,"lightDirection",c.lightDirection),this.material.setUniform(a,"lightColor",c.lightColor),this.material.setUniform(a,"ambientColor",c.ambientColor)),this.material.draw(a,this.geometry.indexData.length),null!==e&&this.material.unsetVao(a)},raycast:function(a){if(this.parent.getWorldMatrix){var b=this.parent.getWorldMatrix().invert();return a.transformMat4(b)}var c=null,d=this.geometry.triangles.some(function(b){return c=a.intersectTriangle(b.a,b.b,b.c)});return d?c:null},clone:function(){return glb.Mesh(this.geometry,this.material)}})}),phina.namespace(function(){phina.define("glb.Object3D",{superClass:"glb.Element",localMatrix:null,worldMatrix:null,invMatrix:null,uvTranslate:null,position:null,rotation:null,scale:null,geometry:null,material:null,visible:!0,needsUpdate:!1,init:function(){this.superInit(),this.localMatrix=glb.Matrix4(),this.worldMatrix=glb.Matrix4(),this.invMatrix=glb.Matrix4(),this.uvTranslate=glb.Vector2(),this.position=glb.Vector3(),this.rotation=glb.Quat(),this.scale=glb.Vector3(1,1,1),this.updateMatrix()},build:function(a){},render:function(a,b,c){this.needsUpdate&&this.updateMatrix(),this.getWorldMatrix()},updateMatrix:function(){return this.localMatrix.fromRotationTranslationScale(this.rotation,this.position,this.scale),this.needsUpdate=!1,this},getWorldMatrix:function(){return this.worldMatrix.copy(this.localMatrix),this.parent&&this.parent.getWorldMatrix&&this.worldMatrix.preMul(this.parent.getWorldMatrix()),this.worldMatrix},worldToLocal:function(a){if(this.parent.getWorldMatrix){var b=this.parent.getWorldMatrix().invert();return a.transformMat4(b)}return a},localToWorld:function(a){var b=this.getWorldMatrix();return a.transformMat4(b)},getWorldRotation:function(){var a=this.rotation.clone();return this.parent&&this.parent.getWorldRotation&&a.mul(this.parent.getWorldRotation()),a},getDirection:function(){return glb.Vector3(0,1,0).transformQuat(this.getWorldRotation())},getScreenCoord:function(a,b){b=b||glb.Vector3(0,0,0);var c=b.transformMat4(this.worldMatrix),d=a.getScreenCoord(c);return glb.Vector2(.5*(d+1)*SCREEN_WIDTH,.5*(d+1)*SCREEN_HEIGHT)},setPosition:function(a,b,c){return this.position.set(a,b,c),this.needsUpdate=!0,this},setScale:function(a,b,c){return 1===arguments.length&&(b=a,c=a),this.scale.set(a,b,c),this.needsUpdate=!0,this},setRotationX:function(a){return this.rotation.setAxisAngle(glb.Vector3.X,a),this.needsUpdate=!0,this},setRotationY:function(a){return this.rotation.setAxisAngle(glb.Vector3.Y,a),this.needsUpdate=!0,this},setRotationZ:function(a){return this.rotation.setAxisAngle(glb.Vector3.Z,a),this.needsUpdate=!0,this},translate:function(a,b,c){return this.position.x+=a,this.position.y+=b,this.position.z+=c,this.needsUpdate=!0,this},translateX:function(b){return vec3.set(a,b,0,0),vec3.transformQuat(a,a,this.rotation.array),this.translate(a[0],a[1],a[2])},translateY:function(b){return vec3.set(a,0,b,0),vec3.transformQuat(a,a,this.rotation.array),this.translate(a[0],a[1],a[2])},translateZ:function(b){return vec3.set(a,0,0,b),vec3.transformQuat(a,a,this.rotation.array),this.translate(a[0],a[1],a[2])},rotateX:function(a){return this.rotation.rotateX(a),this.needsUpdate=!0,this},rotateY:function(a){return this.rotation.rotateY(a),this.needsUpdate=!0,this},rotateZ:function(a){return this.rotation.rotateZ(a),this.needsUpdate=!0,this},_accessor:{x:{set:function(a){this.position.x=a,this.needsUpdate=!0},get:function(){return this.position.x}},y:{set:function(a){this.position.y=a,this.needsUpdate=!0},get:function(){return this.position.y}},z:{set:function(a){this.position.z=a,this.needsUpdate=!0},get:function(){return this.position.z}},scaleX:{set:function(a){this.scale.x=a,this.needsUpdate=!0},get:function(){return this.scale.x}},scaleY:{set:function(a){this.scale.y=a,this.needsUpdate=!0},get:function(){return this.scale.y}},scaleZ:{set:function(a){this.scale.z=a,this.needsUpdate=!0},get:function(){return this.scale.z}}}});var a=vec3.create()}),phina.namespace(function(){phina.define("glb.Ray",{init:function(a,b){a instanceof glb.Vector3?this.origin=a:this.origin=glb.Vector3(a[0],a[1],a[2]),b instanceof glb.Vector3?this.direction=b:this.direction=glb.Vector3(b[0],b[1],b[2]),this.direction.normalize()},transformMat4:function(a){return this.origin.transformMat4(a),this.direction.transformMat4(a),this},intersectTriangle:function(a,b,c){var d=glb.Vector3,e=d.sub(b,a).cross(d.sub(c,b)).normalize();if(0==this.direction.dot(e))return null;var f=d.sub(a,this.origin),g=f.dot(e)/this.direction.dot(e);if(0>g)return null;var h=d.add(this.origin,this.direction.mul(g)),i=d.sub(b,a),j=d.sub(h,a);if(i.cross(j).dot(e)<0)return null;var k=d.sub(c,b),l=d.sub(h,b);if(k.cross(l).dot(e)<0)return null;var m=d.sub(a,c),n=d.sub(h,c);return m.cross(n).dot(e)<0?null:h}})}),phina.define("glb.Screen",{frameBuffer:null,depthRenderBuffer:null,texture:null,init:function(a,b){this.width=a||512,this.height=b||512},build:function(a){var b=a.gl;return this.frameBuffer=b.createFramebuffer(),this.texture=b.createTexture(),this.depthRenderBuffer=b.createRenderbuffer(),b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer),b.bindTexture(b.TEXTURE_2D,this.texture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.width,this.height,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0),b.bindRenderbuffer(b.RENDERBUFFER,this.depthRenderBuffer),b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,this.width,this.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.depthRenderBuffer),b.bindRenderbuffer(b.RENDERBUFFER,null),b.bindTexture(b.TEXTURE_2D,null),b.bindFramebuffer(b.FRAMEBUFFER,null),this}}),phina.namespace(function(){phina.define("glb.L3c",{superClass:"glb.Object3D",poses:null,motionFrame:null,beforePose:null,nextPose:null,init:function(a){this.superInit(),this._rootUnit=a.clone().addChild(this._rootUnit),this.poses={},this._motionFrame=1,this._motionTweener=phina.accessory.Tweener().attachTo(this)},startMotion:function(a,b,c){"string"==typeof a&&(a=this.poses[a]),a||(a=this.poses._initialPose),this.beforePose=this.getCurrentPose(),this.nextPose=a,this.setMotionFrame(0),this._motionTweener.clear().to({motionFrame:1},b,c)},setMotionFrame:function(a){return this._motionFrame=a,1!==this._motionFrame&&this.beforePose!==this.nextPose?(this.beforePose||(this.beforePose=this.poses._initialPose),this.nextPose||(this.nextPose=this.poses._initialPose),glb.L3c._setFrameToUnit(this._rootUnit,this.beforePose,this.nextPose,ratio),this):void 0},getCurrentPose:function(){return glb.L3c._currentPose(this._rootUnit,null)},setPose:function(a){return"string"==typeof a&&(a=this.poses[a]),a||(a=this.poses._initialPose),glb.L3c._setPoseToUnit(this._rootUnit,a),this._motionFrame=1,this.beforePose=this.nextPose=a,this},clone:function(){return glb.L3c(this._rootUnit.clone())},_accessor:{motionFrame:{get:function(){return this._motionFrame},set:function(a){this.setMotionFrame(a)}}},_static:{_setFrameToUnit:function(a,b,c,d){b=b||{pose:[0,0,0,0,0,0],quat:[0,0,0,1],childUnits:[]},c=c||{pose:[0,0,0,0,0,0],quat:[0,0,0,1],childUnits:[]},quat.slerp(a.rotation.array,b.quat,c.quat,d),a.position.x=b.pose[3]+(c.pose[3]-b.pose[3])*d+a.basePosition.x,a.position.y=b.pose[4]+(c.pose[4]-b.pose[4])*d+a.basePosition.x,a.position.z=b.pose[5]+(c.pose[5]-b.pose[5])*d+a.basePosition.x,a.needsUpdate=!0;for(var e=0,f=a.childUnits.length;f>e;e++)glb.L3c._setFrameToUnit(a.childUnits[e],b.childUnits[e],c.childUnits[e],d)},_currentPose:function(a,b){var c={};c.pose=[0,0,0,a.position.x-a.basePosition.x,a.position.y-a.basePosition.y,a.position.z-a.basePosition.z],c.quat=[a.rotation.x,a.rotation.y,a.rotation.z,a.rotation.w],c.childUnits=[];for(var d=0,e=a.childUnits.length;e>d;d++)c.childUnits[d]=glb.L3c._currentPose(a.childUnits[d],c);return c},_setPoseToUnit:function(a,b){b=b||{pose:[0,0,0,0,0,0],quat:[0,0,0,1],childUnits:[]},a.rotation.copy(b.quat),a.position.x=b.pose[3]+a.basePosition.x,a.position.y=b.pose[4]+a.basePosition.y,a.position.z=b.pose[5]+a.basePosition.z,a.needsUpdate=!0;for(var c=0,d=a.childUnits.length;d>c;c++)glb.L3c._setPoseToUnit(a.childUnits[c],b.childUnits[c])}}}),phina.define("glb.L3cUnit",{superClass:"glb.Object3D",basePosition:null,childUnits:null,init:function(a,b){this.superInit(),this._mesh=a.addChildTo(this),this.basePosition=glb.Vector3(b[0],b[1],b[2]),this.childUnits=[]},addChildUnit:function(a){this.addChild(a),this.childUnits[this.childUnits.length]=a},clone:function(){for(var a=glb.L3cUnit(this._mesh.clone(),[this.basePosition.x,this.basePosition.y,this.basePosition.z]),b=0,c=this.childUnits.length;c>b;b++)a.addChildUnit(this.childUnits[b].clone());return this.poses&&(a.poses=this.poses,a.setPose(a.poses._initialPose)),a},_accessor:{mesh:{get:function(){return this._mesh}}},_static:{create:function(a){var b=glb.L3cUnit(a.node,a.basePosition),c=a.child;if(c instanceof Array)for(var d=0,e=c.length;e>d;d++)b.addChildUnit(glb.L3cUnit.create(c[d]));return b}}})}),function(){phina.define("glb.AfterEffectComposer",{glLayer:null,passes:null,init:function(a){this.glLayer=a,this.firstPass=glb.FirstPass(),this.endPass=glb.EndPass(),this.passes=[]},addPass:function(a){this.passes.push(a)},render:function(b,c,d){var e=this.glLayer;if(0===this.passes.length||0===this.passes.filter(a).length)e.attachScreen(null),e.render(b,c,d);else{var f=this.passes.reduce(function(a,b){return b.enabled?b.render(e,a,d):a},this.firstPass.render(e,b,c,d));this.endPass.render(e,f,d)}}});var a=function(a){return a.enabled}}(),function(){phina.define("glb.BlurPass",{superClass:"glb.ShaderPass",init:function(){this.superInit(),this.previousFrameScreen=glb.Screen(),this.rect.mixFactor0=.8,this.rect.mixFactor1=.8,this.rect.mainMaterial=this.rect.material,this.rect.mixMaterial=glb.ScreenTextureMaterial(glb.MixShader()),this.rect.mixMaterial.setTextures=function(a){var b=a.gl;b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture0),b.uniform1i(this.uniforms.texture0.location,0),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,this.texture1),b.uniform1i(this.uniforms.texture1.location,1)},this.rect.build=function(a){var b=a.gl,c=a.ext;this.geometry.build(a),this.mainMaterial.build(a),this.mixMaterial.build(a),null!==c&&(this.mainMaterial.setVao(a),this.mainMaterial.setAttributes(a,this.geometry),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.geometry.index),this.mainMaterial.unsetVao(a),this.mixMaterial.setVao(a),this.mixMaterial.setAttributes(a,this.geometry),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.geometry.index),this.mixMaterial.unsetVao(a))}},render:function(a,b){return this.isBuilt||(this.screen.build(a),this.previousFrameScreen.build(a),this.isBuilt=!0),this.rect.material=this.rect.mixMaterial,this.rect.material.texture0=this.previousFrameScreen.texture,this.rect.material.texture1=b.texture,a.attachScreen(this.screen),a.render(this.scene,this.camera),this.rect.material=this.rect.mainMaterial,this.rect.material.texture=this.screen.texture,a.attachScreen(this.previousFrameScreen),a.render(this.scene,this.camera),this.screen}})}(),phina.define("glb.EndPass",{superClass:"glb.ShaderPass",init:function(){this.superInit(),this.screen=null}}),phina.define("glb.FirstPass",{screen:null,isBuilt:!1,init:function(){this.screen=glb.Screen()},render:function(a,b,c,d){return this.isBuilt||(this.screen.build(a),this.isBuilt=!0),a.attachScreen(this.screen),a.render(b,c,d),this.screen}}),function(){phina.define("glb.DefaultShader",{init:function(){this.attributeMetaData=a,this.uniformMetaData=b,this.vertexShaderSource=c,this.fragmentShaderSource=d}});var a=[{name:"position",size:3},{name:"uv",size:2}],b=[{name:"worldMatrix",type:"mat4"},{name:"vpMatrix",type:"mat4"},{name:"texture",type:"texture"}],c=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 worldMatrix;","uniform mat4 vpMatrix;","varying vec2 vUv;","void main(void) {","    vUv = vec2(uv.x, 1.0 - uv.y);","    gl_Position = vpMatrix * worldMatrix * vec4(position, 1.0);","}"].join("\n"),d=["precision mediump float;","uniform sampler2D texture;","varying vec2 vUv;","void main(void) {","    gl_FragColor = texture2D(texture, vUv);","}"].join("\n")}(),function(){phina.define("glb.MixShader",{superClass:"glb.DefaultShader",init:function(){this.superInit(),this.uniformMetaData=[{name:"worldMatrix",type:"mat4"},{name:"vpMatrix",type:"mat4"},{name:"texture0",type:"texture"},{name:"texture1",type:"texture"},{name:"mixFactor0",type:"float"},{name:"mixFactor1",type:"float"}],this.fragmentShaderSource=["precision mediump float;","uniform float mixFactor0;","uniform float mixFactor1;","uniform sampler2D texture0;","uniform sampler2D texture1;","varying vec2 vUv;","void main(void) {","    vec4 c0 = texture2D(texture0, vUv);","    vec4 c1 = texture2D(texture1, vUv);","    gl_FragColor = clamp(c0 * mixFactor0 + c1 * mixFactor1, 0.0, 1.0);","}"].join("\n")}})}(),function(){phina.define("glb.MonotoneShader",{superClass:"glb.DefaultShader",init:function(){this.superInit(),this.fragmentShaderSource=["precision mediump float;","uniform sampler2D texture;","varying vec2 vUv;","void main(void) {","    vec4 color = texture2D(texture, vUv);","    float c = (color.r + color.g + color.b) / 3.0;","    gl_FragColor = vec4(c, c, c, color.a);","}"].join("\n")}})}(),function(){phina.define("glb.ReverseShader",{superClass:"glb.DefaultShader",init:function(){this.superInit(),this.fragmentShaderSource=["precision mediump float;","uniform sampler2D texture;","varying vec2 vUv;","void main(void) {","    vec4 c = texture2D(texture, vUv);","    gl_FragColor = vec4(1.0 - c.r, 1.0 - c.g, 1.0 - c.b, c.a);","}"].join("\n")}})}(),function(){phina.define("glb.ShaderPass",{isBuilt:!1,screen:null,scene:null,camera:null,rect:null,enabled:!0,init:function(a){a=a||glb.DefaultShader(),this.screen=glb.Screen(),this.scene=phina.app.Scene(),this.camera=glb.OrthoCamera(-.5,.5,-.5,.5,1,20),this.rect=glb.Mesh(glb.PlaneGeometry(1),glb.ScreenTextureMaterial(a)).addChildTo(this.scene)},render:function(a,b){return!this.isBuilt&&this.screen&&(this.screen.build(a),this.isBuilt=!0),this.rect.material.texture=b.texture,a.attachScreen(this.screen),a.render(this.scene,this.camera),this.screen}})}(),function(){phina.define("glb.Bullets",{superClass:"glb.Element",geometry:null,material:null,_mainMaterial:null,_collisionMaterial:null,time:0,bullets:null,visible:!0,collisionScreen:null,collisionPixels:null,init:function(a){this.superInit(),this.geometry=glb.BulletsGeometry(),this._mainMaterial=glb.BulletsMaterial(a),this._collisionMaterial=glb.BulletsCollisionMaterial(),this.collisionScreen=glb.Screen(512,512),this.collisionPixels=new Uint8Array(this.collisionScreen.width*this.collisionScreen.height*4),this.switchMaterial(!0),this.bullets=[];var b=1.5*Math.max(SCREEN_WIDTH,SCREEN_HEIGHT),c=glb.Matrix4().lookAt(glb.Vector3(0,0,10),glb.Vector3(0,0,0),glb.Vector3(0,1,0)),d=glb.Matrix4().ortho(b*-.5,.5*b,b*-.5,.5*b,.1,5e3);this.collisionVpMatrix=glb.Matrix4.mul(d,c)},switchMaterial:function(a){this.material=a?this._mainMaterial:this._collisionMaterial},build:function(a){var b=(a.gl,a.ext);this.geometry.build(a),this._mainMaterial.build(a),this._collisionMaterial.build(a),this.collisionScreen.build(a),null!==b&&(this._mainMaterial.setVao(a),this._mainMaterial.setAttributes(a,this.geometry),this._mainMaterial.unsetVao(a),this._collisionMaterial.setVao(a),this._collisionMaterial.setAttributes(a,this.geometry),this._collisionMaterial.unsetVao(a)),this.isBuilt=!0},update:function(a){this.time+=1e-4;var b=this,c=a.currentScene.camera;this.bullets=this.bullets.filter(function(a){a.position.add(a.velocity);var d=c.getScreenCoord(a.position);return d.x<-1.1||1.1<d.x||d.y<-1.1||1.1<d.y?(b.despawn(a.index),!1):!0})},render:function(a,b){var c=a.gl,d=a.ext;this.geometry.vboNeedUpdate&&(this.geometry.rebind(c),this.geometry.vboNeedUpdate=!1),this.material.setProgram(a),null!==d?this.material.setVao(a):this.material.setAttributes(a,this.geometry),this.material.setTextures(a),this.material.setUniforms(a,this),this.material.setUniform(a,"time",this.time),this.material.setUniform(a,"vpMatrix",b),this.material.draw(a,this.geometry.COUNT),null!==d&&this.material.unsetVao(a)},spawn:function(a,b,c){var d=this.geometry.spawn(this.time,a,b,c);if(!(0>d))return this.bullets.push({position:a,velocity:b,index:d}),d},despawn:function(a){this.geometry.despawn(a)},drawCollisions:function(a){var b=a.gl;return this.switchMaterial(!1),a.attachScreen(this.collisionScreen),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),a.renderObj(this,this.collisionVpMatrix),b.readPixels(0,0,this.collisionScreen.width,this.collisionScreen.height,b.RGBA,b.UNSIGNED_BYTE,this.collisionPixels),this.switchMaterial(!0),a.attachScreen(null),this.collisionPixels},isHit:function(){var a=null;return function(b){null===a&&(a=vec4.create()),vec4.set(a,b.x,b.y,b.z,1),vec4.transformMat4(a,a,this.collisionVpMatrix.array);var c=Math.floor(.5*(a[0]/a[3]+1)*this.collisionScreen.width),d=Math.floor(.5*(a[1]/a[3]+1)*this.collisionScreen.height);return this.collisionPixels[4*(d*this.collisionScreen.width+c)+0]}}()})}(),function(){phina.define("glb.BulletsCollisionMaterial",{superClass:"glb.Material",vpMatrix:null,init:function(){this.superInit(),this.vpMatrix=glb.Matrix4();var a=mat4.create();mat4.lookAt(a,[0,0,.5*SCREEN_HEIGHT/Math.tan(45*Math.DEG_TO_RAD*.5)],[0,0,0],[0,1,0]);var b=mat4.create();mat4.ortho(b,.5*-SCREEN_WIDTH,.5*SCREEN_WIDTH,SCREEN_HEIGHT*-.5,.5*SCREEN_HEIGHT,10,1e4),mat4.mul(this.vpMatrix.array,b,a)},_getVertexShaderSource:function(){return c},_getFragmentShaderSource:function(){return d},_getAttributeMetaData:function(){return a},_getUniformMetaData:function(){return b},setUniforms:function(a,b){this.superSetUniforms(a,b),this.setUniform(a,"vpMatrix",this.vpMatrix)},draw:function(a,b){var c=a.gl;c.drawArrays(c.POINTS,0,b)}});var a=[{name:"initialPosition",size:2},{name:"velocity",size:2},{name:"spawnTime",size:1},{name:"active",size:1}],b=[{name:"vpMatrix",type:"mat4"},{name:"time",type:"float"}],c=["attribute vec2 initialPosition;","attribute vec2 velocity;","attribute float spawnTime;","attribute float active;","uniform mat4 vpMatrix;","uniform float time;","varying float vActive;","void main(void) {","    vActive = active;","    if (active < 0.5) {","        gl_Position = vec4(0.0);","        gl_PointSize = 0.0;","    } else {","        float age = time - spawnTime;","        vec2 pos = initialPosition + velocity * age * 10000.0;","        gl_Position = vpMatrix * vec4(pos, 0.0, 1.0);","        gl_PointSize = {0};".format(BULLET_SIZE.toFloatString()),"    }","}"].join("\n"),d=["precision mediump float;","varying float vActive;","void main(void) {","    if (vActive < 0.5) discard;","    if (0.5 < length(gl_PointCoord - vec2(0.5, 0.5))) discard;","    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n")}(),function(){phina.define("glb.BulletsGeometry",{superClass:"glb.Geometry",COUNT:8192,bufferUsage:1,initialPositionData:null,velocityData:null,spawnTimeData:null,activeData:null,frameIndexData:null,initialPosition:null,velocity:null,spawnTime:null,active:null,frameIndex:null,vboNeedUpdate:!1,init:function(){this.superInit(),this.initialPositionData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0]}).flatten()),this.velocityData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0]}).flatten()),this.spawnTimeData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.activeData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.frameIndexData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0}))},build:function(a){var b=a.gl;this.initialPosition=this.createVbo(b,this.initialPositionData,b.DYNAMIC_DRAW),this.velocity=this.createVbo(b,this.velocityData,b.DYNAMIC_DRAW),this.spawnTime=this.createVbo(b,this.spawnTimeData,b.DYNAMIC_DRAW),this.active=this.createVbo(b,this.activeData,b.DYNAMIC_DRAW),this.frameIndex=this.createVbo(b,this.frameIndexData,b.DYNAMIC_DRAW)},rebind:function(a){this.transfarVbo(a,this.initialPosition,this.initialPositionData),this.transfarVbo(a,this.velocity,this.velocityData),this.transfarVbo(a,this.spawnTime,this.spawnTimeData),this.transfarVbo(a,this.active,this.activeData),this.transfarVbo(a,this.frameIndex,this.frameIndexData)},spawn:function(a,c,d,e){var f=b(this.activeData,0);return 0>f?(console.warn("弾が足りない"),-1):(this.initialPositionData[2*f+0]=c.x,this.initialPositionData[2*f+1]=c.y,this.velocityData[2*f+0]=d.x,this.velocityData[2*f+1]=d.y,this.spawnTimeData[f]=a,this.activeData[f]=1,this.frameIndexData[f]=e,this.vboNeedUpdate=!0,f)},despawn:function(a){a<this.activeData.length&&(this.activeData[a]=0,this.vboNeedUpdate=!0)}});var a=0,b=function(b,c){for(var d=a,e=b.length;e>a;a++)if(b[a]===c)return a;for(a=0;d>a;a++)if(b[a]===c)return a;return a=0,-1}}(),function(){phina.define("glb.BulletsMaterial",{superClass:"glb.Material",_image:null,texture:null,init:function(a){this.superInit(),this._image=a},build:function(a){this._createProgram(a),this._image&&(this.texture=a.createTexture(this._image))},_getVertexShaderSource:function(){return c},_getFragmentShaderSource:function(){return d},_getAttributeMetaData:function(){return a},_getUniformMetaData:function(){return b},setTextures:function(a){var b=a.gl;this.texture?(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture)):b.bindTexture(b.TEXTURE_2D,null)},setUniforms:function(a,b){this.superSetUniforms(a,b),this.setUniform(a,"useTexture",this.texture?1:0)},draw:function(a,b){var c=a.gl;c.disable(c.DEPTH_TEST),c.disable(c.CULL_FACE),c.enable(c.BLEND),this.setUniform(a,"aura",0),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.drawArrays(c.POINTS,0,b),this.setUniform(a,"aura",1),c.blendFunc(c.SRC_ALPHA,c.ONE),c.drawArrays(c.POINTS,0,b),c.enable(c.DEPTH_TEST),c.enable(c.CULL_FACE),c.disable(c.BLEND)}});var a=[{name:"initialPosition",size:2},{name:"velocity",size:2},{name:"spawnTime",size:1},{name:"active",size:1},{name:"frameIndex",size:1}],b=[{name:"vpMatrix",type:"mat4"},{name:"time",type:"float"},{name:"aura",type:"float"}],c=["attribute vec2 initialPosition;","attribute vec2 velocity;","attribute float spawnTime;","attribute float active;","attribute float frameIndex;","uniform mat4 vpMatrix;","uniform float time;","uniform float aura;","varying float vAge;","varying float vActive;","varying float vFrameIndex;","varying float vAngle;","varying mat3 vUvMat;","varying float vAura;","mat3 translate(float x, float y) {","    return mat3(","        1.0, 0.0, 0.0,","        0.0, 1.0, 0.0,","          x,   y, 1.0","    );","}","mat3 rotate(float rad) {","    float s = sin(rad);","    float c = cos(rad);","    return mat3(","        c, s, 0,","       -s, c, 0,","        0, 0, 1","    );","}","void main(void) {","    vActive = active;","    vAura = aura;","    vFrameIndex = frameIndex + mod(floor((time - spawnTime) * 7500.0), 8.0);","    if (active < 0.5) {","        vAngle = 0.0;","        gl_Position = vec4(0.0);","        gl_PointSize = 0.0;","    } else {","        if (frameIndex < 8.0) {","            vAngle = atan(velocity.y, velocity.x);","        } else {","            vAngle = time * 3000.0;","        }","        vAge = time - spawnTime;","        vUvMat = translate(0.5, 0.5) * rotate(vAngle) * translate(-0.5, -0.5);","        vec2 pos = initialPosition + velocity * ((time - spawnTime) * 10000.0);","        gl_Position = vpMatrix * vec4(pos, 0.0, 1.0);","        float c = sin(vAge * 5500.0) * 4.0 - 2.0;","        gl_PointSize = ({0} + c) * (1.0 + aura * 0.5);".format(BULLET_APPEALANCE.toFloatString()),"    }","}"].join("\n"),d=["precision mediump float;","uniform sampler2D texture;","varying float vAge;","varying float vActive;","varying float vFrameIndex;","varying float vAngle;","varying mat3 vUvMat;","varying float vAura;","void main(void) {","    if (vActive < 0.5) discard;","    vec3 buv = vec3(gl_PointCoord.x, gl_PointCoord.y, 1.0);","    vec3 ruv = vUvMat * buv;","    vec2 uv = vec2((ruv.x + vFrameIndex) * 0.0625, ruv.y);","    float c = sin(vAge * 6200.0) * 0.12;","    vec4 light = vec4(0.0, c, 0.0, 0.0);","    vec4 result = light + texture2D(texture, uv);","    if (vAura < 0.5) {","        if (0.58 < length(gl_PointCoord - vec2(0.5, 0.5))) discard;","        if (result.a < 0.9) discard;","        gl_FragColor = result;","    } else {","        float c = 0.4 - length(gl_PointCoord - vec2(0.5, 0.5));","        if (c < 0.0) discard;","        gl_FragColor = vec4(0.5, 0.5, 1.0, c * 0.8);","    }","}"].join("\n");
}(),phina.namespace(function(){phina.define("glb.ObjMesh",{superClass:"glb.Mesh",init:function(a){this.superInit();var b=phina.asset.AssetManager.get("wavefront.obj",a).geometry,c=glb.PhongMaterial({color:phina.util.Color(255,255,255,1),image:phina.asset.AssetManager.get("image",a).domElement});this.superInit(b,c)}})}),function(){phina.define("glb.ParticleGeometry",{superClass:"glb.Geometry",COUNT:8192,bufferUsage:1,initialPositionData:null,velocityFromData:null,velocityToData:null,spawnTimeData:null,activeData:null,frameIndexData:null,ttlData:null,sizeFromData:null,sizeToData:null,colorFromData:null,colorToData:null,initialPosition:null,velocityFrom:null,velocityTo:null,spawnTime:null,active:null,frameIndex:null,ttl:null,sizeFrom:null,sizeTo:null,colorFrom:null,colorTo:null,vboNeedUpdate:!1,init:function(){this.superInit(),this.initialPositionData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0]}).flatten()),this.velocityFromData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0]}).flatten()),this.velocityToData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0]}).flatten()),this.spawnTimeData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.activeData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.frameIndexData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.ttlData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.sizeFromData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.sizeToData=new Float32Array(Array.range(0,this.COUNT).map(function(){return 0})),this.colorFromData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[1,1,1,1]}).flatten()),this.colorToData=new Float32Array(Array.range(0,this.COUNT).map(function(){return[0,0,0,0]}).flatten())},build:function(a){var b=a.gl;this.initialPosition=this.createVbo(b,this.initialPositionData,b.DYNAMIC_DRAW),this.velocityFrom=this.createVbo(b,this.velocityFromData,b.DYNAMIC_DRAW),this.velocityTo=this.createVbo(b,this.velocityToData,b.DYNAMIC_DRAW),this.spawnTime=this.createVbo(b,this.spawnTimeData,b.DYNAMIC_DRAW),this.active=this.createVbo(b,this.activeData,b.DYNAMIC_DRAW),this.frameIndex=this.createVbo(b,this.frameIndexData,b.DYNAMIC_DRAW),this.ttl=this.createVbo(b,this.ttlData,b.DYNAMIC_DRAW),this.sizeFrom=this.createVbo(b,this.sizeFromData,b.DYNAMIC_DRAW),this.sizeTo=this.createVbo(b,this.sizeToData,b.DYNAMIC_DRAW),this.colorFrom=this.createVbo(b,this.colorFromData,b.DYNAMIC_DRAW),this.colorTo=this.createVbo(b,this.colorToData,b.DYNAMIC_DRAW)},rebind:function(a){this.transfarVbo(a,this.initialPosition,this.initialPositionData),this.transfarVbo(a,this.velocityFrom,this.velocityFromData),this.transfarVbo(a,this.velocityTo,this.velocityToData),this.transfarVbo(a,this.spawnTime,this.spawnTimeData),this.transfarVbo(a,this.active,this.activeData),this.transfarVbo(a,this.frameIndex,this.frameIndexData),this.transfarVbo(a,this.ttl,this.ttlData),this.transfarVbo(a,this.sizeFrom,this.sizeFromData),this.transfarVbo(a,this.sizeTo,this.sizeToData),this.transfarVbo(a,this.colorFrom,this.colorFromData),this.transfarVbo(a,this.colorTo,this.colorToData)},spawn:function(b,c){var d=a(this.activeData,0);return 0>d?(console.warn("パーティクルが足りない"),-1):(this.initialPositionData[2*d+0]=c.position.x,this.initialPositionData[2*d+1]=c.position.y,this.velocityFromData[2*d+0]=c.velocityFrom.x,this.velocityFromData[2*d+1]=c.velocityFrom.y,this.velocityToData[2*d+0]=c.velocityTo.x,this.velocityToData[2*d+1]=c.velocityTo.y,this.spawnTimeData[d]=b,this.activeData[d]=1,this.frameIndexData[d]=c.frameIndex,this.ttlData[d]=c.ttl,this.sizeFromData[d]=c.sizeFrom,this.sizeToData[d]=c.sizeTo,this.colorFromData[4*d+0]=c.colorFrom.r/255,this.colorFromData[4*d+1]=c.colorFrom.g/255,this.colorFromData[4*d+2]=c.colorFrom.b/255,this.colorFromData[4*d+3]=c.colorFrom.a,this.colorToData[4*d+0]=c.colorTo.r/255,this.colorToData[4*d+1]=c.colorTo.g/255,this.colorToData[4*d+2]=c.colorTo.b/255,this.colorToData[4*d+3]=c.colorTo.a,this.vboNeedUpdate=!0,d)},despawn:function(a){a<this.activeData.length&&(this.activeData[a]=0,this.vboNeedUpdate=!0)}});var a=function(a,b){return Array.prototype.indexOf.call(a,b)}}(),function(){phina.define("glb.ParticleMaterial",{superClass:"glb.Material",_image:null,texture:null,init:function(a){this.superInit(),this._image=a},build:function(a){this._createProgram(a),this._image&&(this.texture=a.createTexture(this._image))},_getVertexShaderSource:function(){return c},_getFragmentShaderSource:function(){return d},_getAttributeMetaData:function(){return a},_getUniformMetaData:function(){return b},setTextures:function(a){var b=a.gl;this.texture?(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture)):b.bindTexture(b.TEXTURE_2D,null)},setUniforms:function(a,b){this.superSetUniforms(a,b),this.setUniform(a,"useTexture",this.texture?1:0)},draw:function(a,b){var c=a.gl;c.disable(c.DEPTH_TEST),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE),c.drawArrays(c.POINTS,0,b),c.enable(c.DEPTH_TEST),c.enable(c.CULL_FACE),c.disable(c.BLEND)}});var a=[{name:"initialPosition",size:2},{name:"velocityFrom",size:2},{name:"velocityTo",size:2},{name:"spawnTime",size:1},{name:"active",size:1},{name:"frameIndex",size:1},{name:"ttl",size:1},{name:"sizeFrom",size:1},{name:"sizeTo",size:1},{name:"colorFrom",size:4},{name:"colorTo",size:4}],b=[{name:"vpMatrix",type:"mat4"},{name:"time",type:"float"}],c=["attribute vec2 initialPosition;","attribute float spawnTime;","attribute float active;","attribute float frameIndex;","attribute float ttl;","attribute vec2 velocityFrom;","attribute vec2 velocityTo;","attribute float sizeFrom;","attribute float sizeTo;","attribute vec4 colorFrom;","attribute vec4 colorTo;","uniform mat4 vpMatrix;","uniform float time;","varying float vAge;","varying float vActive;","varying float vFrameIndex;","varying float vSize;","varying vec4 vColor;","float lerp(float from, float to, float time, float duration) {","    return from + (to - from) * time / duration;","}","vec2 lerp(vec2 from, vec2 to, float time, float duration) {","    return from + (to - from) * time / duration;","}","vec4 lerp(vec4 from, vec4 to, float time, float duration) {","    return from + (to - from) * time / duration;","}","void main(void) {","    vActive = active;","    vFrameIndex = frameIndex;","    if (active < 0.5) {","        gl_Position = vec4(0.0);","        gl_PointSize = 0.0;","    } else {","        vAge = time - spawnTime;","        vSize = lerp(sizeFrom, sizeTo, vAge, ttl);","        vColor = lerp(colorFrom, colorTo, vAge, ttl);","        vec2 v = lerp(velocityFrom, velocityTo, vAge, ttl);","        float phina = vAge * 10000.0;","        vec2 pos = initialPosition + velocityFrom * phina + (v - velocityFrom) * phina * 0.5;","        gl_Position = vpMatrix * vec4(pos, 0.0, 1.0);","        gl_PointSize = vSize * {0};".format(GL_QUALITY.toFloatString()),"    }","}"].join("\n"),d=["precision mediump float;","uniform sampler2D texture;","varying float vAge;","varying float vActive;","varying float vFrameIndex;","varying float vSize;","varying vec4 vColor;","void main(void) {","    if (vActive < 0.5) discard;","    vec2 uv = vec2((gl_PointCoord.x + vFrameIndex) * 0.0625, gl_PointCoord.y);","    gl_FragColor = vColor * texture2D(texture, uv);","}"].join("\n")}(),function(){phina.define("glb.ParticleSystem",{superClass:"glb.Element",geometry:null,material:null,particles:null,time:0,visible:!0,init:function(a){this.superInit(),this.geometry=glb.ParticleGeometry(),this.material=glb.ParticleMaterial(a),this.particles=[],this.time=0},build:function(a){var b=(a.gl,a.ext);this.geometry.build(a),this.material.build(a),null!==b&&(this.material.setVao(a),this.material.setAttributes(a,this.geometry),this.material.unsetVao(a))},update:function(a){this.time+=1e-4;var b=this,c=this.time;this.particles=this.particles.filter(function(a){return a.deathTime<=c?(b.despawn(a.index),!1):!0})},render:function(a,b){var c=a.gl,d=a.ext;this.geometry.vboNeedUpdate&&(this.geometry.rebind(c),this.geometry.vboNeedUpdate=!1),this.material.setProgram(a),null!==d?this.material.setVao(a):this.material.setAttributes(a,this.geometry),this.material.setTextures(a),this.material.setUniforms(a,this),this.material.setUniform(a,"time",this.time),this.material.setUniform(a,"vpMatrix",b),this.material.draw(a,this.geometry.COUNT),null!==d&&this.material.unsetVao(a)},spawn:function(b){var c=this.geometry.spawn(this.time,{}.$extend(a,b));if(!(0>c))return this.particles.push({deathTime:this.time+b.ttl,index:c}),c},despawn:function(a){this.geometry.despawn(a)}});var a={position:{x:0,y:0},frameIndex:0,ttl:.006,velocityFrom:{x:1,y:0},velocityTo:{x:0,y:0},sizeFrom:30,sizeTo:30,colorFrom:{r:255,g:255,b:255,a:1},colorTo:{r:255,g:255,b:255,a:0}}}(),phina.namespace(function(){phina.define("glb.L3cAsset",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this._orig=null},_load:function(a){var b=this,c=this.src,d=new XMLHttpRequest;d.open("GET",c),d.onreadystatechange=function(){4===d.readyState&&-1!==[200,201,0].indexOf(d.status)&&(b.parse(d.responseText),a(b))},d.send(null)},parse:function(a){var b=JSON.parse(a);glb.L3cAsset.create(b.geometries,b.textures)},get:function(){return this._orig.clone()},_static:{create:function(a,b){}}})}),phina.namespace(function(){phina.define("glb.L3pAsset",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this._meshList=null},_load:function(a){var b=this,c=this.src,d=new XMLHttpRequest;d.open("GET",c),d.onreadystatechange=function(){if(4===d.readyState&&-1!==[200,201,0].indexOf(d.status)){b.parse(d.responseText);var c=b._meshList.map(function(a){var b=a.material.image;return b?phina.util.Flow(function(a){b.src=b._src,delete b._src,b.onload=function(){a()}}):phina.util.Flow.resolve()});phina.util.Flow.all(c).then(function(){a(b)})}},d.send(null)},parse:function(a){var b=JSON.parse(a);this._meshList=glb.L3pAsset.create(b.geometries,b.textures)},get:function(){var a=glb.Object3D();return this._meshList.forEach(function(b){a.push(b.clone())}),a},_static:{create:function(a,b){return a.map(function(a){var b=a.texture,c=glb.Geometry();c.positionData=a.vertices,c.normalData=a.normals,c.uvData=a.texCoords,c.indexData=a.indices;var d=b.ambient,e=b.diffuse,f=255*(d[0]+e[0])/2,a=255*(d[1]+e[1])/2,g=255*(d[2]+e[2])/2,h=(d[3]+e[3])/2,i=null;return b.src&&(i=new Image,i._src=b.src),glb.Mesh(c,glb.PhongMaterial({color:phina.util.Color(f,a,g,h),image:i}))})}}})}),function(){phina.define("glb.ObjAsset",{superClass:"phina.asset.Asset",geometry:null,materials:null,init:function(){this.superInit(),this.geometry=null,this.materials=null,this._vertices=[],this._faces=[],this._normals=[],this._texcoords=[],this._materialName=null},createMesh:function(){return glb.Mesh(this.geometry,glb.PhongMaterial({image:phina.asset.AssetManager.get("image",this.src.key).domElement}))},_load:function(a){var b=this.src.url,c=this.src.key,d=this,e=phina.util.Flow(function(a){var c=new XMLHttpRequest;c.open("GET",b),c.onreadystatechange=function(){4===c.readyState&&-1!==[200,201,0].indexOf(c.status)&&(d.parse(c.responseText),d.geometry=d.buildGeometry(),d.materials=d.buildMaterials(),a())},c.send(null)}),f=phina.util.Flow(function(a){var d=b.replace(/\.obj/,".png");phina.asset.Texture().load(d).then(function(b){phina.asset.AssetManager.set("image",c,b),a()})});phina.util.Flow.all([e,f]).then(function(){a(d)})},parse:function(a){var b=this,c=a.split("\n");c.forEach(function(a){b.parseLine(a.trim())})},buildGeometry:function(){var a=glb.GeometryBuilder(),b=this._vertices;return this._faces.forEach(function(c){var d;c.d?(d=glb.Face4(),[c.a,c.b,c.c,c.d].forEach(function(a,c){var e=b[a.index];d.setPositionIndex(c,e.x,e.y,e.z).setNormalIndex(c,a.normal.x,a.normal.y,a.normal.z).setUvIndex(c,a.texcoord.x,a.texcoord.y,a.texcoord.z)})):(d=glb.Face(),[c.a,c.b,c.c].forEach(function(a,c){var e=b[a.index];d.setPositionIndex(c,e.x,e.y,e.z).setNormalIndex(c,a.normal.x,a.normal.y,a.normal.z).setUvIndex(c,a.texcoord.x,a.texcoord.y,a.texcoord.z)})),a.addFace(d)}),this.src.originToCenter&&a.setOriginToCenter(),this.src.transform&&a.setTransform(this.src.transform),a.build()},buildMaterials:function(){},parseLine:function(a){var b;if(0!==a.length&&"#"!==a[0])if(b=a.match(/^usemtl (.+)$/))this._materialName=b[1];else if(b=a.match(/^mtllib (.+)$/));else{var c=a.substring(0,2);switch(c.trim()){case"vn":return void this.parseVn(a.substring(3));case"vt":return void this.parseVt(a.substring(3));case"v":return void this.parseV(a.substring(2));case"f":return void this.parseF(a.substring(2))}}},parseVn:function(a){var b=a.split(" ");this._normals.push({x:-Number(b[0]),y:-Number(b[1]),z:-Number(b[2])})},parseVt:function(a){var b=a.split(" ");this._texcoords.push({x:Number(b[0]),y:Number(b[1])})},parseV:function(a){var b=a.split(" ");this._vertices.push({x:Number(b[0]),y:Number(b[1]),z:Number(b[2])})},parseF:function(a){var b=this,c=/^(-?\d+)\/(\d+)\/(\d+)$/,d=a.split(" ").map(function(a){var d;if(d=a.trim().match(c)){var e=Number(d[1]),f=Number(d[2]),g=Number(d[3]);return{index:0>e?b._vertices.length+e:e-1,texcoord:b._texcoords[f-1],normal:b._normals[g-1]}}});4==d.length?this._faces.push({a:d[0],b:d[1],c:d[2],d:d[3],materialName:this._materialName}):3==d.length&&this._faces.push({a:d[0],b:d[1],c:d[2],materialName:this._materialName})}}),phina.asset.AssetLoader.assetLoadFunctions["wavefront.obj"]=function(a,b){return"string"==typeof b?b={key:a,url:b}:b.key=a,glb.ObjAsset().load(b)}}(),phina.namespace(function(){phina.util.Color.prototype.accessor("typedArray",{set:function(a){this.r=255*a[0],this.g=255*a[1],this.b=255*a[2],this.a=a[3]},get:function(){return null==this._typedArray&&(this._typedArray=new Float32Array(4)),this._typedArray[0]=this.r/255,this._typedArray[1]=this.g/255,this._typedArray[2]=this.b/255,this._typedArray[3]=this.a,this._typedArray}})}),function(){phina.define("glb.Matrix3",{array:null,init:function(){this.array=mat3.create()},fromMat4:function(a){return mat3.fromMat4(this.array,a.array),this},clone:function(){var a=glb.Matrix3();return a.array=mat3.clone(this.array),a},identity:function(){return mat3.identity(this.array),this},transpose:function(){return mat3.transpose(this.array,this.array),this},invert:function(){return mat3.invert(this.array,this.array),this},adjoint:function(){return mat3.adjoint(this.array,this.array),this},determinant:function(){return mat3.determinant(this.array)},mul:function(a){return mat3.multiply(this.array,this.array,a.array),this},translate:function(a){return mat3.translate(this.array,this.array,a.array),this},scale:function(a){return mat3.scale(this.array,this.array,a.array),this},rotate:function(a,b){return mat3.rotate(this.array,this.array,a,b.array),this},fromTranslation:function(a){mat3.fromTranslation(this.array,a.array)},fromRotation:function(a){return mat3.fromRotation(this.array,a),this},fromScaling:function(a){return mat3.fromScaling(this.array,a.array),this},fromQuat:function(a){return mat3.fromQuat(this.array,a.array),this},normalFromMat4:function(a){return mat3.normalFromMat4(this.array,a.array),this},getRotationZ:function(){return Math.atan2(this.array[3],this.array[0])},_accessor:{typedArray:{get:function(){return this.array},set:function(a){this.array=a}}}})}(),function(){phina.define("glb.Matrix4",{array:null,init:function(){this.array=mat4.create()},copy:function(a){return mat4.copy(this.array,a.array),this},clone:function(){var a=glb.Matrix4();return a.array=mat4.clone(this.array),a},identity:function(){return mat4.identity(this.array),this},transpose:function(){return mat4.transpose(this.array,this.array),this},invert:function(){return mat4.invert(this.array,this.array),this},adjoint:function(){return mat4.adjoint(this.array,this.array),this},determinant:function(){return mat4.determinant(this.array)},mul:function(a){return mat4.multiply(this.array,this.array,a.array),this},preMul:function(a){return mat4.multiply(this.array,a.array,this.array),this},translate:function(a){return mat4.translate(this.array,this.array,a.array),this},scale:function(a){return mat4.scale(this.array,this.array,a.array),this},rotate:function(a,b){return mat4.rotate(this.array,this.array,a,b.array),this},rotateX:function(a){return mat4.rotateX(this.array,this.array,a),this},rotateY:function(a){return mat4.rotateY(this.array,this.array,a),this},rotateZ:function(a){return mat4.rotateZ(this.array,this.array,a),this},fromTranslation:function(a){return mat4.fromTranslation(this.array,a.array),this},fromScaling:function(a){return mat4.fromScaling(this.array,a.array),this},fromRotation:function(a,b){return mat4.fromRotation(this.array,a,b.array),this},fromXRotation:function(a){return mat4.fromXRotation(this.array,a),this},fromYRotation:function(a){return mat4.fromYRotation(this.array,a),this},fromZRotation:function(a){return mat4.fromZRotation(this.array,a),this},fromRotationTranslation:function(a,b){return mat4.fromRotationTranslation(this.array,a.array,b.array),this},fromRotationTranslationScale:function(a,b,c){return mat4.fromRotationTranslationScale(this.array,a.array,b.array,c.array),this},fromRotationTranslationScaleOrigin:function(a,b,c,d){return mat4.fromRotationTranslationScaleOrigin(this.array,a.array,b.array,c.array,d.array),this},fromQuat:function(a){return mat4.fromQuat(this.array,a.array),this},frustum:function(a,b,c,d,e,f){return mat4.frustum(this.array,a,b,c,d,e,f),this},perspective:function(a,b,c,d){return mat4.perspective(this.array,a,b,c,d),this},perspectiveFromFieldOfView:function(a,b,c){return mat4.perspectiveFromFieldOfView(this.array,a,b,c),this},ortho:function(a,b,c,d,e,f){return mat4.ortho(this.array,a,b,c,d,e,f),this},lookAt:function(a,b,c){return mat4.lookAt(this.array,a.array,b.array,c.array),this},viewport:function(a,b){return this.identity(),this.array[0]=.5*a,this.array[5]=b*-.5,this.array[12]=.5*a,this.array[13]=.5*b,this},_accessor:{typedArray:{get:function(){return this.array},set:function(a){this.array=a}}}}),glb.Matrix4.mul=function(a,b){var c=glb.Matrix4();return mat4.mul(c.array,a.array,b.array),c}}(),function(){phina.define("glb.Quat",{array:null,init:function(a,b,c,d){this.array=quat.create(),this.set(a||0,b||0,c||0,d||1)},set:function(a,b,c,d){return quat.set(this.array,a,b,c,d),this},rotationTo:function(a,b){return quat.rotationTo(this.array,a.array,b.array),this},setAxes:function(a,b,c){return quat.setAxes(this.array,a.array,b.array,c.array),this},copy:function(a){return quat.copy(this.array,a.array),this},clone:function(){var a=glb.Quat();return a.array=quat.clone(this.array),a},identity:function(){return quat.identity(this.array),this},setAxisAngle:function(a,b){return quat.setAxisAngle(this.array,a.array,b),this},add:function(a){return quat.add(this.array,this.array,a.array),this},mul:function(a){return quat.multiply(this.array,this.array,a.array),this},rotateX:function(a){return quat.rotateX(this.array,this.array,a),this},rotateY:function(a){return quat.rotateY(this.array,this.array,a),this},rotateZ:function(a){return quat.rotateZ(this.array,this.array,a),this},calculateW:function(){return quat.calculateW(this.array,this.array),this},dot:function(a){return quat.dot(this.array,a.array)},slerp:function(a,b){return quat.slerp(this.array,this.array,a.array,b),this},invert:function(){return quat.invert(this.array,this.array),this},conjugate:function(){return quat.conjugate(this.array,this.array),this},length:function(){return quat.length(this.array)},squaredLength:function(){return quat.squaredLength(this.array)},normalize:function(){return quat.normalize(this.array,this.array),this},fromMat3:function(a){return quat.fromMat3(this.array,a.array),this},toMat3:function(){var a=glb.Matrix3();return mat3.fromQuat(a.array,this.array),a},getAngle:function(){return 2*Math.acos(quat.dot(this.array,[0,0,0,1]))},getAngleTo:function(a){return 2*Math.acos(a.dot(this.array,a.array))},_accessor:{typedArray:{get:function(){return this.array},set:function(a){this.array=a}},x:{get:function(){return this.array[0]},set:function(a){this.array[0]=a}},y:{get:function(){return this.array[1]},set:function(a){this.array[1]=a}},z:{get:function(){return this.array[2]},set:function(a){this.array[2]=a}},w:{get:function(){return this.array[3]},set:function(a){this.array[3]=a}}}}),glb.Quat.slerp=function(a,b,c){var d=glb.Quat();return quat.slerp(d.array,a.array,b.array,c),d},glb.Quat.getAngle=function(a,b){return 2*Math.acos(quat.dot(a.array,b.array))}}(),function(){phina.define("glb.Vector2",{init:function(a,b){this.array=vec2.create(),this.set(a||0,b||0)},clone:function(){return glb.Vector2(this.x,this.y)},copy:function(a){return this.set(a.x,a.y)},set:function(a,b){return vec2.set(this.array,a,b),this},add:function(a){return vec2.add(this.array,this.array,a.array),this},sub:function(a){return vec2.sub(this.array,this.array,a.array),this},mul:function(a){return vec2.scale(this.array,this.array,a),this},length:function(){return vec2.length(this.array)},squaredLength:function(){return vec2.squaredLength(this.array)},negate:function(){return vec2.negate(this.array,this.array),this},inverse:function(){return vec2.inverse(this.array,this.array),this},normalize:function(){return vec2.normalize(this.array,this.array),this},dot:function(a){return vec2.dot(this.array,a.array)},cross:function(a){var b=glb.Vector3();return vec2.cross(b.array,this.array,a.array),b},fromAngleLength:function(a,b){return this.set(Math.cos(a)*b,Math.sin(a)*b)},random:function(a,b,c,d){var e=Math.random()*Math.PI,f=Math.randf(c,d);return this.set(a+Math.cos(e)*f,b+Math.sin(e)*f)},_accessor:{typedArray:{get:function(){return this.array},set:function(a){this.array=a}}}}),glb.Vector2.prototype.accessor("x",{set:function(a){this.array[0]=a},get:function(){return this.array[0]}}),glb.Vector2.prototype.accessor("y",{set:function(a){this.array[1]=a},get:function(){return this.array[1]}}),glb.Vector2.distance=function(a,b){return vec2.distance(a.array,b.array)},glb.Vector2.squaredDistance=function(a,b){return vec2.squaredDistance(a.array,b.array)}}(),function(){phina.define("glb.Vector3",{array:null,init:function(a,b,c){this.array=vec3.create(),this.set(a||0,b||0,c||0)},set:function(a,b,c){return vec3.set(this.array,a,b,c),this},copy:function(a){return vec3.copy(this.array,a.array),this},clone:function(){return glb.Vector3(this.x,this.y,this.z)},lerp:function(a,b){return vec3.lerp(this.array,this.array,a.array,b),this},add:function(a){return vec3.add(this.array,this.array,a.array),this},sub:function(a){return vec3.sub(this.array,this.array,a.array),this},mul:function(a){return vec3.scale(this.array,this.array,a),this},length:function(){return vec3.length(this.array)},squaredLength:function(){return vec3.squaredLength(this.array)},negate:function(){return vec3.negate(this.array,this.array),this},inverse:function(){return vec3.inverse(this.array,this.array),this},normalize:function(){return vec3.normalize(this.array,this.array),this},dot:function(a){return vec3.dot(this.array,a.array)},cross:function(a){return vec3.cross(this.array,this.array,a.array),this},transformMat4:function(a){return vec3.transformMat4(this.array,this.array,a.array),this},transformMat3:function(a){return vec3.transformMat3(this.array,this.array,a.array),this},transformQuat:function(a){return vec3.transformQuat(this.array,this.array,a.array),this},setX:function(a){return this.array[0]=a,this},setY:function(a){return this.array[1]=a,this},setZ:function(a){return this.array[2]=a,this},_accessor:{typedArray:{get:function(){return this.array},set:function(a){this.array=a}},x:{set:function(a){this.array[0]=a},get:function(){return this.array[0]}},y:{set:function(a){this.array[1]=a},get:function(){return this.array[1]}},z:{set:function(a){this.array[2]=a},get:function(){return this.array[2]}}}}),glb.Vector3.distance=function(a,b){return vec3.distance(a.array,b.array)},glb.Vector3.squaredDistance=function(a,b){return vec3.squaredDistance(a.array,b.array)},glb.Vector3.angle=function(a,b){return vec3.angle(a.array,b.array)},glb.Vector3.cross=function(a,b){var c=glb.Vector3();return vec3.cross(c.array,a.array,b.array),c},glb.Vector3.lerp=function(a,b,c){var d=glb.Vector3();return vec3.lerp(d.array,a.array,b.array,c),d},glb.Vector3.add=function(a,b){var c=glb.Vector3();return vec3.add(c.array,a.array,b.array),c},glb.Vector3.sub=function(a,b){var c=glb.Vector3();return vec3.sub(c.array,a.array,b.array),c},glb.Vector3.mul=function(a,b){var c=glb.Vector3().copy(a);return c.mul(b)},glb.Vector3.distance=function(a,b){return vec3.distance(a.array,b.array)},glb.Vector3.squaredDistance=function(a,b){return vec3.squaredDistance(a.array,b.array)},glb.Vector3.negate=function(a){var b=glb.Vector3();return vec3.negate(glb.Vector3.array,a.array),b},glb.Vector3.inverse=function(a){var b=glb.Vector3();return vec3.inverse(glb.Vector3.array,a.array),b},glb.Vector3.normalize=function(a){var b=glb.Vector3();return vec3.normalize(glb.Vector3.array,a.array),b},glb.Vector3.transformMat4=function(a,b){var c=glb.Vector3().copy(a);return vec3.transformMat4(c.array,c.array,b.array),c},glb.Vector3.transformMat3=function(a,b){var c=glb.Vector3().copy(a);return vec3.transformMat3(c.array,c.array,b.array),c},glb.Vector3.transformQuat=function(a,b){var c=glb.Vector3().copy(a);return vec3.transformQuat(c.array,c.array,b.array),c},glb.Vector3.X=glb.Vector3(1,0,0),glb.Vector3.Y=glb.Vector3(0,1,0),glb.Vector3.Z=glb.Vector3(0,0,1)}(),phina.define("glb.BoxGeometry",{superClass:"glb.Geometry",position:null,uv:null,index:null,init:function(a,b,c){this.superInit(),a=a||1,b=b||a,c=c||a,a*=.5,b*=.5,c*=.5;var d=glb.GeometryBuilder().addFace(glb.Face4().setPositionA(-a,b,-c).setPositionB(-a,-b,-c).setPositionC(-a,-b,c).setPositionD(-a,b,c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).addFace(glb.Face4().setPositionA(-a,b,c).setPositionB(-a,-b,c).setPositionC(a,-b,c).setPositionD(a,b,c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).addFace(glb.Face4().setPositionA(a,b,c).setPositionB(a,-b,c).setPositionC(a,-b,-c).setPositionD(a,b,-c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).addFace(glb.Face4().setPositionA(a,b,-c).setPositionB(a,-b,-c).setPositionC(-a,-b,-c).setPositionD(-a,b,-c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).addFace(glb.Face4().setPositionA(-a,b,-c).setPositionB(-a,b,c).setPositionC(a,b,c).setPositionD(a,b,-c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).addFace(glb.Face4().setPositionA(-a,-b,c).setPositionB(-a,-b,-c).setPositionC(a,-b,-c).setPositionD(a,-b,c).setUvA(0,1).setUvB(0,0).setUvC(1,0).setUvD(1,1)).calcFaceNormals().build();this.$extend(d)},build:function(a){var b=a.gl;this.position=this.createVbo(b,this.positionData),this.normal=this.createVbo(b,this.normalData),this.uv=this.createVbo(b,this.uvData),this.vertexColor=this.createVbo(b,this.vertexColorData),this.index=this.createIbo(b,this.indexData)}}),phina.define("glb.CubeMapGeometry",{superClass:"glb.Geometry",position:null,uv:null,index:null,init:function(a){this.superInit(),a=a||1;var b=a,c=a;a*=.5,b*=.5,c*=.5;var d=glb.GeometryBuilder().addFace(glb.Face4().setPositionA(-a,+b,-c).setPositionB(-a,-b,-c).setPositionC(-a,-b,+c).setPositionD(-a,+b,+c).setUvA(0,.75).setUvB(0,.5).setUvC(.25,.5).setUvD(.25,.75).reverse()).addFace(glb.Face4().setPositionA(-a,+b,+c).setPositionB(-a,-b,+c).setPositionC(+a,-b,+c).setPositionD(+a,+b,+c).setUvA(.25,.75).setUvB(.25,.5).setUvC(.5,.5).setUvD(.5,.75).reverse()).addFace(glb.Face4().setPositionA(+a,+b,+c).setPositionB(+a,-b,+c).setPositionC(+a,-b,-c).setPositionD(+a,+b,-c).setUvA(.5,.75).setUvB(.5,.5).setUvC(.75,.5).setUvD(.75,.75).reverse()).addFace(glb.Face4().setPositionA(+a,+b,-c).setPositionB(+a,-b,-c).setPositionC(-a,-b,-c).setPositionD(-a,+b,-c).setUvA(.75,.75).setUvB(.75,.5).setUvC(1,.5).setUvD(1,.75).reverse()).addFace(glb.Face4().setPositionA(-a,+b,-c).setPositionB(-a,+b,+c).setPositionC(+a,+b,+c).setPositionD(+a,+b,-c).setUvA(.25,1).setUvB(.25,.75).setUvC(.5,.75).setUvD(.5,1).reverse()).addFace(glb.Face4().setPositionA(-a,-b,+c).setPositionB(-a,-b,-c).setPositionC(+a,-b,-c).setPositionD(+a,-b,+c).setUvA(.25,.5).setUvB(.25,.25).setUvC(.5,.25).setUvD(.5,.5).reverse()).calcFaceNormals().build();this.$extend(d)},build:function(a){var b=a.gl;this.position=this.createVbo(b,this.positionData),this.normal=this.createVbo(b,this.normalData),this.uv=this.createVbo(b,this.uvData),this.vertexColor=this.createVbo(b,this.vertexColorData),this.index=this.createIbo(b,this.indexData)}}),phina.define("glb.Geometry",{materialIndexData:null,positionData:null,normalData:null,uvData:null,vertexColorData:null,indexData:null,materialIndex:null,position:null,normal:null,uvData:null,vertexColor:null,index:null,isBuild:!1,init:function(){this._triangles=null},build:function(a){if(!this.isBuild){var b=a.gl;this.materialIndex=this.createVbo(b,this.materialIndexData),this.position=this.createVbo(b,this.positionData),this.normal=this.createVbo(b,this.normalData),this.uv=this.createVbo(b,this.uvData),this.vertexColor=this.createVbo(b,this.vertexColorData),this.index=this.createIbo(b,this.indexData),this.isBuild=!0}},createVbo:function(a,b,c){c=c||GL.STATIC_DRAW;var d=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,d),a.bufferData(a.ARRAY_BUFFER,b,c),a.bindBuffer(a.ARRAY_BUFFER,null),d},transfarVbo:function(a,b,c,d,e){return d=d||0,e=e||GL.STATIC_DRAW,a.bindBuffer(a.ARRAY_BUFFER,b),a.bufferSubData(a.ARRAY_BUFFER,d,c),a.bindBuffer(a.ARRAY_BUFFER,null),b},createIbo:function(a,b,c){c=c||GL.STATIC_DRAW;var d=a.createBuffer();return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d),a.bufferData(a.ELEMENT_ARRAY_BUFFER,b,c),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),d},_accessor:{triangles:{get:function(){if(null!=this._triangles)return this._triangles;this._triangles=[];for(var a=this.indexData,b=this.positionData,c=0,d=a.length;d>c;c+=9){var e=b[a[c+0]],f=b[a[c+1]],g=b[a[c+2]],h=b[a[c+3]],i=b[a[c+4]],j=b[a[c+5]],k=b[a[c+6]],l=b[a[c+7]],m=b[a[c+8]];this._triangles.push({a:glb.Vector3(e,f,g),b:glb.Vector3(h,i,j),c:glb.Vector3(k,l,m)})}return this._triangles}}}}),phina.define("glb.PlaneGeometry",{superClass:"glb.Geometry",position:null,uv:null,index:null,init:function(a,b,c){this.superInit(),a=a||32,b=b||1,c=c||1,this.positionData=new Float32Array([[.5*-a,.5*-a,0],[.5*a,.5*-a,0],[.5*-a,.5*a,0],[.5*a,.5*a,0]].flatten()),this.uvData=new Float32Array([[0,0],[1/b,0],[0,1/c],[1/b,1/c]].flatten()),this.indexData=new Int16Array([0,1,2,1,3,2])},build:function(a){var b=a.gl;this.position=this.createVbo(b,this.positionData),this.uv=this.createVbo(b,this.uvData),this.index=this.createIbo(b,this.indexData)}}),function(){phina.define("glb.Face",{init:function(){this.setUvA(0,0),this.setUvB(0,0),this.setUvC(0,0),this.setFaceColor(1,1,1,1)},setMaterialIndex:function(a){this.materialIndex=a},setPositionIndex:function(a,b,c,d){switch(a){case 0:return this.setPositionA(b,c,d);case 1:return this.setPositionB(b,c,d);case 2:return this.setPositionC(b,c,d)}},setPositionA:function(a,b,c){return this.positionA=[a,b,c],this},setPositionB:function(a,b,c){return this.positionB=[a,b,c],this},setPositionC:function(a,b,c){return this.positionC=[a,b,c],this},setNormalIndex:function(a,b,c,d){switch(a){case 0:return this.setNormalA(b,c,d);case 1:return this.setNormalB(b,c,d);case 2:return this.setNormalC(b,c,d)}},setNormalA:function(a,b,c){return this.normalA=[a,b,c],this},setNormalB:function(a,b,c){return this.normalB=[a,b,c],this},setNormalC:function(a,b,c){return this.normalC=[a,b,c],this},setFaceNormal:function(a,b,c){return this.normalA=[a,b,c],this.normalB=[a,b,c],this.normalC=[a,b,c],this},calcFaceNormal:function(){var b=vec3.set(a(),this.positionA[0],this.positionA[1],this.positionA[2]),c=vec3.set(a(),this.positionB[0],this.positionB[1],this.positionB[2]),d=vec3.set(a(),this.positionC[0],this.positionC[1],this.positionC[2]),e=vec3.sub(a(),b,c),f=vec3.sub(a(),d,b),g=vec3.cross(a(),e,f);return vec3.normalize(g,g),this.setFaceNormal(g[0],g[1],g[2]),
this},setUvIndex:function(a,b,c){switch(a){case 0:return this.setUvA(b,c);case 1:return this.setUvB(b,c);case 2:return this.setUvC(b,c)}},setUvA:function(a,b){return this.uvA=[a,b],this},setUvB:function(a,b){return this.uvB=[a,b],this},setUvC:function(a,b){return this.uvC=[a,b],this},setColorIndex:function(a,b,c,d,e){switch(a){case 0:return this.setColorA(b,c,d,e);case 1:return this.setColorB(b,c,d,e);case 2:return this.setColorC(b,c,d,e)}},setColorA:function(a,b,c,d){return this.vertexColorA=[a,b,c,d],this},setColorB:function(a,b,c,d){return this.vertexColorB=[a,b,c,d],this},setColorC:function(a,b,c,d){return this.vertexColorC=[a,b,c,d],this},setFaceColor:function(a,b,c,d){return this.vertexColorA=[a,b,c,d],this.vertexColorB=[a,b,c,d],this.vertexColorC=[a,b,c,d],this},getVertex:function(a){switch(a){case 0:return this.getVertexA();case 1:return this.getVertexB();case 2:return this.getVertexC()}},getVertexA:function(){return{materialIndex:this.materialIndex,position:this.positionA,normal:this.normalA,uv:this.uvA,vertexColor:this.vertexColorA}},getVertexB:function(){return{materialIndex:this.materialIndex,position:this.positionB,normal:this.normalB,uv:this.uvB,vertexColor:this.vertexColorB}},getVertexC:function(){return{materialIndex:this.materialIndex,position:this.positionC,normal:this.normalC,uv:this.uvC,vertexColor:this.vertexColorC}},translate:function(a){vec3.add(this.positionA,this.positionA,a),vec3.add(this.positionB,this.positionB,a),vec3.add(this.positionC,this.positionC,a)}});var a=vec3.create}(),function(){phina.define("glb.Face4",{init:function(){this.setUvA(0,0),this.setUvB(0,0),this.setUvC(0,0),this.setUvD(0,0),this.setFaceColor(1,1,1,1)},split:function(){var a=glb.Face();a.positionA=this.positionA,a.positionB=this.positionB,a.positionC=this.positionC,a.normalA=this.normalA,a.normalB=this.normalB,a.normalC=this.normalC,a.uvA=this.uvA,a.uvB=this.uvB,a.uvC=this.uvC,a.vertexColorA=this.vertexColorA,a.vertexColorB=this.vertexColorB,a.vertexColorC=this.vertexColorC;var b=glb.Face();return b.positionA=this.positionA,b.positionB=this.positionC,b.positionC=this.positionD,b.normalA=this.normalA,b.normalB=this.normalC,b.normalC=this.normalD,b.uvA=this.uvA,b.uvB=this.uvC,b.uvC=this.uvD,b.vertexColorA=this.vertexColorA,b.vertexColorB=this.vertexColorC,b.vertexColorC=this.vertexColorD,[a,b]},setMaterialIndex:function(a){this.materialIndex=a},setPositionIndex:function(a,b,c,d){switch(a){case 0:return this.setPositionA(b,c,d);case 1:return this.setPositionB(b,c,d);case 2:return this.setPositionC(b,c,d);case 3:return this.setPositionD(b,c,d)}},setPositionA:function(a,b,c){return this.positionA=[a,b,c],this},setPositionB:function(a,b,c){return this.positionB=[a,b,c],this},setPositionC:function(a,b,c){return this.positionC=[a,b,c],this},setPositionD:function(a,b,c){return this.positionD=[a,b,c],this},setNormalIndex:function(a,b,c,d){switch(a){case 0:return this.setNormalA(b,c,d);case 1:return this.setNormalB(b,c,d);case 2:return this.setNormalC(b,c,d);case 3:return this.setNormalD(b,c,d)}},setNormalA:function(a,b,c){return this.normalA=[a,b,c],this},setNormalB:function(a,b,c){return this.normalB=[a,b,c],this},setNormalC:function(a,b,c){return this.normalC=[a,b,c],this},setNormalD:function(a,b,c){return this.normalD=[a,b,c],this},setFaceNormal:function(a,b,c){return this.normalA=[a,b,c],this.normalB=[a,b,c],this.normalC=[a,b,c],this.normalD=[a,b,c],this},calcFaceNormal:function(){var b=vec3.set(a(),this.positionA[0],this.positionA[1],this.positionA[2]),c=vec3.set(a(),this.positionB[0],this.positionB[1],this.positionB[2]),d=vec3.set(a(),this.positionC[0],this.positionC[1],this.positionC[2]),e=vec3.sub(a(),b,c),f=vec3.sub(a(),d,b),g=vec3.cross(a(),e,f);return vec3.normalize(g,g),this.setFaceNormal(g[0],g[1],g[2]),this},setUvIndex:function(a,b,c){switch(a){case 0:return this.setUvA(b,c);case 1:return this.setUvB(b,c);case 2:return this.setUvC(b,c);case 3:return this.setUvD(b,c)}},setUvA:function(a,b){return this.uvA=[a,b],this},setUvB:function(a,b){return this.uvB=[a,b],this},setUvC:function(a,b){return this.uvC=[a,b],this},setUvD:function(a,b){return this.uvD=[a,b],this},setVertexColorIndex:function(a,b,c,d,e){switch(a){case 0:return this.setVertexColorA(b,c,d,e);case 1:return this.setVertexColorB(b,c,d,e);case 2:return this.setVertexColorC(b,c,d,e);case 3:return this.setVertexColorD(b,c,d,e)}},setVertexColorA:function(a,b,c,d){return this.vertexColorA=[a,b,c,d],this},setVertexColorB:function(a,b,c,d){return this.vertexColorB=[a,b,c,d],this},setVertexColorC:function(a,b,c,d){return this.vertexColorC=[a,b,c,d],this},setVertexColorD:function(a,b,c,d){return this.vertexColorD=[a,b,c,d],this},setFaceColor:function(a,b,c,d){return this.vertexColorA=[a,b,c,d],this.vertexColorB=[a,b,c,d],this.vertexColorC=[a,b,c,d],this.vertexColorD=[a,b,c,d],this},getVertex:function(a){switch(a){case 0:return this.getVertexA();case 1:return this.getVertexB();case 2:return this.getVertexC();case 3:return this.getVertexD()}},getVertexA:function(){return{materialIndex:this.materialIndex,position:this.positionA,normal:this.normalA,uv:this.uvA,vertexColor:this.vertexColorA}},getVertexB:function(){return{materialIndex:this.materialIndex,position:this.positionB,normal:this.normalB,uv:this.uvB,vertexColor:this.vertexColorB}},getVertexC:function(){return{materialIndex:this.materialIndex,position:this.positionC,normal:this.normalC,uv:this.uvC,vertexColor:this.vertexColorC}},getVertexD:function(){return{materialIndex:this.materialIndex,position:this.positionD,normal:this.normalD,uv:this.uvD,vertexColor:this.vertexColorD}},translate:function(a){vec3.add(this.positionA,this.positionA,a),vec3.add(this.positionB,this.positionB,a),vec3.add(this.positionC,this.positionC,a),vec3.add(this.positionD,this.positionD,a)},reverse:function(){var a=this.positionA;return this.positionA=this.positionD,this.positionD=a,a=this.positionB,this.positionB=this.positionC,this.positionC=a,a=this.uvA,this.uvA=this.uvD,this.uvD=a,a=this.uvB,this.uvB=this.uvC,this.uvC=a,a=this.vertexColorA,this.vertexColorA=this.vertexColorD,this.vertexColorD=a,a=this.vertexColorB,this.vertexColorB=this.vertexColorC,this.vertexColorC=a,a=this.normalA,this.normalA=this.normalB,this.normalD=a,a=this.normalB,this.normalB=this.normalC,this.normalC=a,[this.normalA,this.normalB,this.normalC,this.normalD].forEach(function(a){a&&(a[0]*=-1,a[1]*=-1,a[2]*=-1)}),this}});var a=vec3.create}(),function(){phina.define("glb.GeometryBuilder",{init:function(){this.faces=[],this.transform=glb.Matrix4()},addFace:function(a){return this.faces.push(a),this},calcFaceNormals:function(){return this.faces.forEach(function(a){a.calcFaceNormal()}),this},setOriginToCenter:function(){var a=vec3.create(),b=0,c=this.faces.map(function(a){return a instanceof glb.Face?a:a.split()}).flatten();c.forEach(function(c,d){if(null==c.positionA||null==c.positionB||null==c.positionC)throw console.error(c),new Error("faceの頂点が欠けてる("+d+")");3..times(function(d){var e=c.getVertex(d);vec3.add(a,a,e.position),b+=1})}),0!=b&&(vec3.scale(a,a,1/b),vec3.scale(a,a,-1),this.faces.forEach(function(b){b.translate(a)}))},setTransform:function(a){this.transform=a},build:function(){var b=this,c=glb.Geometry(),d=[],e=[],f=[],g=this.faces.map(function(a){return a instanceof glb.Face?a:a.split()}).flatten();return g.forEach(function(b,c){if(null==b.positionA||null==b.positionB||null==b.positionC)throw console.error(b),new Error("faceの頂点が欠けてる("+c+")");3..times(function(c){var g=b.getVertex(c),h=a(g),i=e.indexOf(h);0>i&&(i=d.length,d.push(g),e.push(h)),f.push(i)})}),c.materialIndexData=new Float32Array(d.map(function(a){return a.materialIndex}).flatten()),c.positionData=new Float32Array(d.map(function(a){return vec3.transformMat4(a.position,a.position,b.transform.array),a.position}).flatten()),c.normalData=new Float32Array(d.map(function(a){var c=mat3.fromMat4(mat3.create(),b.transform.array);return vec3.transformMat3(a.normal,a.normal,c),vec3.normalize(a.normal,a.normal),a.normal}).flatten()),c.uvData=new Float32Array(d.map(function(a){return a.uv}).flatten()),c.vertexColorData=new Float32Array(d.map(function(a){return a.vertexColor}).flatten()),c.indexData=new Int16Array(f),c}});var a=function(a){var b=1,c=31;return b=c*~~b+a.materialIndex,b=c*~~b+1e3*a.position[0],b=c*~~b+1e3*a.position[1],b=c*~~b+1e3*a.position[2],b=c*~~b+1e3*a.normal[0],b=c*~~b+1e3*a.normal[1],b=c*~~b+1e3*a.normal[2],b=c*~~b+1e3*a.uv[0],b=c*~~b+1e3*a.uv[1],b=c*~~b+1e3*a.vertexColor[0],b=c*~~b+1e3*a.vertexColor[1],b=c*~~b+1e3*a.vertexColor[2],b=c*~~b+1e3*a.vertexColor[3],""+b}}(),function(){phina.define("glb.BasicMaterial",{superClass:"glb.Material",color:null,_image:null,texture:null,isBuild:!1,init:function(b){this.superInit(),b={}.$extend(a,b),this.color=b.color,this._image=b.image},setColor:function(a){return this.color=a,this},build:function(a){this.isBuild||(this._createProgram(a),this._image&&(this.texture=a.createTexture(this._image)),this.isBuild=!0)},_getVertexShaderSource:function(){return d},_getFragmentShaderSource:function(){return e},_getAttributeMetaData:function(){return b},_getUniformMetaData:function(){return c},setAttributes:function(a,b){this.superSetAttributes(a,b)},setTextures:function(a){var b=a.gl;this.texture?(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0)):b.bindTexture(b.TEXTURE_2D,null)},setUniforms:function(a,b){this.superSetUniforms(a,b),this.setUniform(a,"color",this.color),this.setUniform(a,"useTexture",this.texture?1:0)},draw:function(a,b){var c=a.gl;c.drawElements(c.TRIANGLES,b,c.UNSIGNED_SHORT,0)}});var a={color:phina.util.Color(255,255,255,1),image:null},b=[{name:"position",size:3},{name:"uv",size:2}],c=[{name:"worldMatrix",type:"mat4"},{name:"vpMatrix",type:"mat4"},{name:"texture",type:"texture"},{name:"uvTranslate",type:"vec2"},{name:"color",type:"color"},{name:"useTexture",type:"int"}],d=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 worldMatrix;","uniform mat4 vpMatrix;","uniform vec4 color;","varying vec2 vUv;","varying vec4 vColor;","void main(void) {","    vUv = uv;","    vColor = color;","    gl_Position = vpMatrix * worldMatrix * vec4(position, 1.0);","}"].join("\n"),e=["precision mediump float;","uniform sampler2D texture;","uniform vec2 uvTranslate;","uniform int useTexture;","varying vec2 vUv;","varying vec4 vColor;","void main(void) {","    if (bool(useTexture)) {","        gl_FragColor = vColor * texture2D(texture, uvTranslate + vUv);","    } else {","        gl_FragColor = vColor;","    }","}"].join("\n")}(),function(){phina.define("glb.Material",{program:null,vao:null,attributes:null,uniforms:null,isBuild:!1,init:function(){},build:function(a){this.isBuild||(this._createProgram(a),this.isBuild=!0)},_getVertexShaderSource:function(){return c},_getFragmentShaderSource:function(){return d},_getAttributeMetaData:function(){return a},_getUniformMetaData:function(){return b},_createProgram:function(a){var b=a.gl,c=a.ext,d=this._createShader(b,b.VERTEX_SHADER,this._getVertexShaderSource()),e=this._createShader(b,b.FRAGMENT_SHADER,this._getFragmentShaderSource());if(this.program=b.createProgram(),b.attachShader(this.program,d),b.attachShader(this.program,e),b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(b.getProgramInfoLog(this.program));return null!==c&&(this.vao=c.createVertexArrayOES()),this.attributes=this._getAttributeMetaData().reduce(function(a,c){return a[c.name]={name:c.name,size:c.size,location:b.getAttribLocation(this.program,c.name)},a}.bind(this),{}),this.uniforms=this._getUniformMetaData().reduce(function(a,c){return a[c.name]={name:c.name,type:c.type,location:b.getUniformLocation(this.program,c.name)},a}.bind(this),{}),this},_createShader:function(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS))return d;throw new Error(a.getShaderInfoLog(d))},setProgram:function(a){var b=a.gl;b.useProgram(this.program)},setVao:function(a){var b=a.ext;null!==b&&b.bindVertexArrayOES(this.vao)},unsetVao:function(a){var b=a.ext;null!==b&&b.bindVertexArrayOES(null)},setAttributes:function(a,b){var c=a.gl,d=this.attributes;Object.keys(this.attributes).forEach(function(a){var e=d[a];b[a]&&(c.bindBuffer(c.ARRAY_BUFFER,b[a]),c.enableVertexAttribArray(e.location),c.vertexAttribPointer(e.location,e.size,c.FLOAT,!1,0,0))})},setTextures:function(a){},setUniforms:function(a,b){var c=(a.gl,this),d=this.uniforms;Object.keys(this.uniforms).forEach(function(e){d[e];b[e]&&c.setUniform(a,e,b[e])})},setUniform:function(a,b,c){var d=a.gl,e=this.uniforms[b];if(c.typedArray&&(c=c.typedArray),e)switch(e.type){case"float":d.uniform1f(e.location,c);break;case"int":case"texture":d.uniform1i(e.location,c);break;case"vec2":d.uniform2fv(e.location,c);break;case"vec3":d.uniform3fv(e.location,c);break;case"vec4":case"color":d.uniform4fv(e.location,c);break;case"mat3":d.uniformMatrix3fv(e.location,!1,c);break;case"mat4":d.uniformMatrix4fv(e.location,!1,c)}},draw:function(a,b){}}),glb.Material.prototype.superSetAttributes=glb.Material.prototype.setAttributes,glb.Material.prototype.superSetUniforms=glb.Material.prototype.setUniforms;var a=[],b=[],c=["void main(void) {","    gl_Position = vec4(1.0);","}"].join("\n"),d=["precision mediump float;","void main(void) {","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","}"].join("\n")}(),function(){phina.define("glb.PhongMaterial",{superClass:"glb.BasicMaterial",init:function(a){this.superInit(a)},_getVertexShaderSource:function(){return c},_getFragmentShaderSource:function(){return d},_getAttributeMetaData:function(){return a},_getUniformMetaData:function(){return b}});var a=({color:phina.util.Color(255,255,255,1),image:null},[{name:"position",size:3},{name:"normal",size:3},{name:"uv",size:2},{name:"vertexColor",size:4}]),b=[{name:"worldMatrix",type:"mat4"},{name:"vpMatrix",type:"mat4"},{name:"invMatrix",type:"mat4"},{name:"texture",type:"texture"},{name:"color",type:"color"},{name:"useTexture",type:"int"},{name:"lightDirection",type:"vec3"},{name:"lightColor",type:"color"},{name:"ambientColor",type:"color"}],c=["attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec4 vertexColor;","uniform mat4 worldMatrix;","uniform mat4 vpMatrix;","uniform vec4 color;","uniform mat4 invMatrix;","uniform vec3 lightDirection;","uniform vec4 lightColor;","uniform vec4 ambientColor;","varying vec2 vUv;","varying vec4 vColor;","vec3 rgbToHsv(vec3 c) {","    vec4 k = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","    vec4 p = mix(vec4(c.bg, k.wz), vec4(c.gb, k.xy), step(c.b, c.g));","    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","    float d = q.x - min(q.w, q.y);","    float e = 1.0e-10;","    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsvToRgb(vec3 c) {","    vec4 k = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","    vec3 p = abs(fract(c.xxx + k.xyz) * 6.0 - k.www);","    return c.z * mix(k.xxx, clamp(p - k.xxx, 0.0, 1.0), c.y);","}","void main(void) {","    vUv = uv;","    vec3 invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;","    float d = clamp(dot(normal, invLight), 0.1, 1.0);","    vec4 dColor = lightColor * vec4(vec3(d), 1.0);","    vColor = clamp(color * vertexColor * (dColor + ambientColor), 0.0, 1.0);","    gl_Position = vpMatrix * worldMatrix * vec4(position, 1.0);","}"].join("\n"),d=["precision mediump float;","uniform sampler2D texture;","uniform int useTexture;","varying vec2 vUv;","varying vec4 vColor;","void main(void) {","    if (bool(useTexture)) {","        gl_FragColor = clamp(vColor * texture2D(texture, vUv), 0.0, 1.0);","    } else {","        gl_FragColor = clamp(vColor, 0.0, 1.0);","    }","}"].join("\n")}(),function(){phina.define("glb.ScreenTextureMaterial",{superClass:"glb.Material",texture:null,init:function(a){this.superInit(),this._vertexShaderSource=a.vertexShaderSource,this._fragmentShaderSource=a.fragmentShaderSource,this._attributeMetaData=a.attributeMetaData,this._uniformMetaData=a.uniformMetaData},_getVertexShaderSource:function(){return this._vertexShaderSource},_getFragmentShaderSource:function(){return this._fragmentShaderSource},_getAttributeMetaData:function(){return this._attributeMetaData},_getUniformMetaData:function(){return this._uniformMetaData},setTextures:function(a){var b=a.gl;b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture)},draw:function(a,b){var c=a.gl;c.drawElements(c.TRIANGLES,b,c.UNSIGNED_SHORT,0)}})}(),phina.define("glb.LoadingScene",{superClass:"phina.display.CanvasScene",init:function(a){this.superInit(),this.backgroundColor="black",phina.display.Label("loading",{color:"white"}).setPosition(.5*SCREEN_WIDTH,.5*SCREEN_HEIGHT).addChildTo(this).on("enterframe",function(a){var b=a.app.ticker.frame;this.text="downloading"+".".repeat(b%5)});var b=phina.asset.AssetLoader(),c=b.load(a.assets);c.then(function(){this.app.replaceScene(a.nextScene())}.bind(this))}}),function(){var a=Math.DEG_TO_RAD;phina.define("glb.Scene",{superClass:"phina.display.CanvasScene",light:null,init:function(){this.superInit({width:SCREEN_WIDTH,height:SCREEN_HEIGHT});var b=30*a,c=-30*a,d=this.camera=glb.PerspectiveCamera(b,SCREEN_WIDTH/SCREEN_HEIGHT,100,2e4),e=.5*SCREEN_HEIGHT/Math.tan(.5*b);d.position.y=Math.sin(c)*e*1.1,d.position.z=Math.cos(c)*e*1.1,d.needsUpdate=!0,this.light=glb.Light().addChildTo(this),this.backgroundLayer=phina.display.CanvasElement().addChildTo(this),this.glLayer=glb.GLLayer().addChildTo(this)},projXY:function(a){var b=this.camera.position,c=glb.Vector3.sub(a,b);return c.mul(b.z/(b.z-a.z)),b.clone().add(c)}})}();
//# sourceMappingURL=gl-bullethell.js.map